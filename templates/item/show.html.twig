{% extends 'base.html.twig' %}

{% block title %}{{ item.title }}{% endblock %}

{% block body %}

<style>
    .font-pro { font-family: 'Poppins', sans-serif; }

    /* LE CONTENEUR PRINCIPAL */
    .main-card {
        background: white;
        border-radius: 15px; /* Arrondi plus doux */
        box-shadow: 0 5px 25px rgba(0,0,0,0.06);
        overflow: hidden;
        border: none;
    }

    /* PARTIE GAUCHE : IMAGE (RÃ©duite) */
    .image-section {
        background-color: #f8f9fa;
        min-height: 400px; /* RÃ©duit de 500 Ã  400 */
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px; /* Moins d'espace autour */
        position: relative;
    }
    
    .image-section img {
        max-width: 100%;
        max-height: 400px; /* L'image ne sera pas gÃ©ante */
        object-fit: contain;
        filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
        border-radius: 6px;
    }

    /* PARTIE DROITE : INFOS (Plus serrÃ©e) */
    .info-section {
        padding: 30px; /* RÃ©duit de 50 Ã  30 */
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    /* Badge Statut (Plus petit) */
    .status-badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 50px;
        font-size: 0.7rem; /* Plus petit */
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .status-lost { background-color: #ffe5e5; color: #d63031; }
    .status-found { background-color: #e5f9ed; color: #27ae60; }

    /* Titre et dÃ©tails (RÃ©duits) */
    h1 { 
        font-weight: 700; 
        color: #2c3e50; 
        font-size: 1.8rem; /* RÃ©duit de 2.5 Ã  1.8 */
        margin-top: 10px;
        margin-bottom: 5px;
    }
    .location-date { 
        color: #95a5a6; 
        font-weight: 500; 
        font-size: 0.85rem; 
        margin-bottom: 20px; 
    }
    .description-title { 
        font-size: 0.75rem; 
        text-transform: uppercase; 
        letter-spacing: 1px; 
        color: #b2bec3; 
        font-weight: 700; 
        margin-bottom: 5px; 
    }
    .description-text { 
        color: #636e72; 
        line-height: 1.6; 
        font-size: 0.9rem; /* Texte standard plus petit */
    }

    /* SECTION PROPRIÃ‰TAIRE */
    .owner-section {
        margin-top: auto;
        padding-top: 20px;
        border-top: 1px solid #f1f2f6;
    }
    
    .avatar-placeholder {
        width: 40px; height: 40px; /* Avatar plus petit */
        background: #dfe6e9; color: #636e72;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-weight: 700; font-size: 1rem;
        margin-right: 12px;
    }

    .btn-call {
        background-color: #27ae60;
        color: white;
        width: 100%;
        padding: 10px; /* Bouton moins gros */
        border-radius: 8px;
        font-weight: 600;
        border: none;
        font-size: 0.95rem;
        display: flex; align-items: center; justify-content: center; gap: 8px;
        transition: transform 0.2s;
    }
    .btn-call:hover { background-color: #219150; transform: translateY(-2px); color: white; }

    /* Boutons Edit/Delete */
    .btn-action {
        width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; transition: 0.2s; font-size: 0.8rem;
    }
    .btn-edit { background: #e3f2fd; color: #0984e3; }
    .btn-delete { background: #ffeaa7; color: #d63031; }
    .btn-action:hover { transform: scale(1.1); }

</style>

<div class="container py-4 font-pro">
    
    {# Lien retour #}
    <a href="{{ path('app_item') }}" class="text-decoration-none text-muted mb-3 d-inline-block fw-bold small">
        <i class="bi bi-arrow-left"></i> Retour
    </a>

    {# LA GRANDE CARTE #}
    <div class="card main-card">
        <div class="row g-0">
            
            {# --- GAUCHE : IMAGE --- #}
            <div class="col-lg-6 image-section">
                
                {# BOUTONS ADMIN #}
                {% if app.user and app.user == item.user %}
                    <div class="position-absolute top-0 end-0 m-3 d-flex gap-2">
                        <a href="{{ path('item_edit', {'id': item.id}) }}" class="btn-action btn-edit" title="Modifier">
                            <i class="bi bi-pencil-fill"></i>
                        </a>
                        <form method="post" action="{{ path('item_delete', {'id': item.id}) }}" onsubmit="return confirm('Supprimer ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
                            <button class="btn-action btn-delete">
                                <i class="bi bi-trash-fill"></i>
                            </button>
                        </form>
                    </div>
                {% endif %}

                {% if item.image %}
                    <img src="{{ asset('uploads/items/' ~ item.image) }}" alt="{{ item.title }}">
                {% else %}
                    <div class="text-muted small">Pas de photo ðŸ“·</div>
                {% endif %}
            </div>

            {# --- DROITE : INFOS --- #}
            <div class="col-lg-6">
                <div class="info-section">
                    
                    <div>
                        <span class="status-badge {{ item.status == 'lost' ? 'status-lost' : 'status-found' }}">
                            {{ item.status == 'lost' ? 'PERDU' : 'TROUVÃ‰' }}
                        </span>

                        <h1>{{ item.title }}</h1>
                        
                        <p class="location-date">
                            <i class="bi bi-geo-alt-fill"></i> {{ item.city }} &nbsp;â€¢&nbsp; 
                            <i class="bi bi-calendar-event"></i> {{ item.dateLost|date('d/m/Y') }}
                        </p>

                        <div class="mb-3">
                            <p class="description-title">DESCRIPTION</p>
                            <p class="description-text">
                                {{ item.description }}
                            </p>
                        </div>

                        {% if item.color %}
                            <div class="mb-3">
                                <p class="description-title">COULEUR</p>
                                <p class="description-text">{{ item.color }}</p>
                            </div>
                        {% endif %}
                    </div>

                    {# --- ZONE PROPRIÃ‰TAIRE --- #}
                    {% if not app.user or app.user != item.user %}
                        <div class="owner-section">
                            <div class="d-flex align-items-center mb-3">
                                {% if item.user %}
                                    <div class="avatar-placeholder">
                                        {{ item.user.firstName|first|upper }}
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark" style="font-size: 0.95rem;">{{ item.user.firstName }} {{ item.user.lastName }}</div>
                                        <small class="text-muted" style="font-size: 0.75rem;">Membre</small>
                                    </div>
                                {% else %}
                                    <span class="text-muted small">Anonyme</span>
                                {% endif %}
                            </div>

                            {% if item.user and item.user.phoneNumber %}
                                <a href="tel:{{ item.user.phoneNumber }}" class="btn btn-call">
                                    <i class="bi bi-telephone-fill"></i> {{ item.user.phoneNumber }}
                                </a>
                            {% else %}
                                <button class="btn btn-light w-100 py-2 text-muted fw-bold border" disabled style="font-size: 0.9rem;">
                                    Pas de numÃ©ro
                                </button>
                            {% endif %}
                        </div>
                    {% endif %}

                </div>
            </div>

        </div>
    </div>

</div>
{% endblock %}